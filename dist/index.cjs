"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),f=require("@inertiajs/vue3");function T(){const t=e.ref([]);function n(l){r(l)||t.value.push(l)}function o(l){r(l)&&(t.value=t.value.filter(u=>u!==l))}function r(l){return t.value.includes(l)}function a(){return t.value.length>0}function s(){return t.value.length}return{register:n,unregister:o,hasOverlay:r,hasOverlays:a,size:s,stack:e.readonly(t),activeOverlayId:e.computed(()=>a()?t.value[t.value.length-1]:null)}}let k=null;function y(){return k||(k=T()),k}function Y(){const t=e.ref(null);function n(){return new URL(window.location.href).searchParams.get("overlay")}function o(r){t.value=r}return{options:t,overlayQueryParam:n,setOptions:o}}let x=null;function m(){return x||(x=Y()),x}function U(t){const n=y(),o=f.usePage(),r=e.ref(),a=e.ref({});function s(){var i;return new URL(`${window.location.host}${o.url}`).searchParams.has("overlay",t)&&((i=m().options.value)==null?void 0:i.id)===t&&n.activeOverlayId.value===t}function l(){if(!s())return r.value;const{options:c}=m();return r.value=c.value,c.value}function u(){if(!s())return a.value;const{options:c}=m(),i={};for(const d of c.value.props)i[d]=a.value[d]??o.props[d];return a.value=o.props,i}return{options:e.computed(l),props:e.computed(u),isContextActive:s}}function z(){const t=new Set;function n(a){return t.add(a),()=>o(a)}function o(a){t.delete(a)}function r(a){t.forEach(s=>{s(a)})}return[{listen:n,remove:o},r]}const p={OVERLAY:"X-Inertia-Overlay",OVERLAY_INDEX:"X-Inertia-Overlay-Index",OVERLAY_ID:"X-Inertia-Overlay-Id",OVERLAY_OPENING_ID:"X-Inertia-Overlay-Opening-Id",OVERLAY_CLOSING_ID:"X-Inertia-Overlay-Closing-Id",OVERLAY_STACK:"X-Inertia-Overlay-Stack",OVERLAY_ROOT_URL:"X-Inertia-Overlay-Root-Url",OVERLAY_PREVIOUS_URL:"X-Inertia-Overlay-Previous-Url",OVERLAY_PAGE_COMPONENT:"X-Inertia-Overlay-Page-Component"},C=new Map;function $(t){const n=y(),o=U(t),[r,a]=z(),s=e.reactive({status:"closed"}),l=e.ref(),u=e.computed(()=>n.stack.value.indexOf(t));function c(v){switch(console.log(`Overlay [${t}] status changed to: ${v}`),s.status=v,v){case"opening":n.register(t),l.value=window.location.href;break;case"closed":n.unregister(t);break}a(v)}function i(...v){return v.includes(s.status)}function d(){i("opening","open")||(c("opening"),o.isContextActive()?e.nextTick(()=>c("open")):f.router.reload({headers:{[p.OVERLAY_OPENING_ID]:t},data:{overlay:t},onSuccess(){c("open")},onError:()=>{c("closed")}}))}function _(){if(!i("closing","closed"))if(c("closing"),o.isContextActive()){const v=Date.now();f.router.reload({headers:{[p.OVERLAY_CLOSING_ID]:t},onSuccess(){const N=Date.now()-v,D=Math.max(0,250-N);setTimeout(()=>c("closed"),D)},onError(){c("open")}})}else e.nextTick(()=>c("closed"))}return{id:t,state:s,index:u,onStatusChange:r,open:d,close:_,hasStatus:i,get previousUrl(){return l.value},get options(){return o.options.value},get props(){return o.props.value}}}function M(t,n={}){if(Object.keys(n).length===0)return t;const o=JSON.stringify(n),r=btoa(decodeURI(encodeURIComponent(o)));return`${t}:${r}`}function O(t,n,o){const r=n!==void 0&&!("autoOpen"in n),a=r?M(t,n):t,s=r?o:n,l=(s==null?void 0:s.autoOpen)??!0;if(!C.has(a)){const u=$(a);C.set(a,u),l&&u.open()}return C.get(a)}const h=e.ref(0),g=e.ref(0),I=e.ref(0);function X(t){const n=e.ref(I.value),o=e.ref(0);function r(){o.value=h.value,h.value=n.value,g.value++,g.value===1&&(document.body.style.overflow="hidden")}function a(){h.value=o.value,g.value--,g.value===0&&(document.body.style.overflow="")}return e.watch(t,s=>{s?r():a()}),e.onBeforeMount(()=>{I.value++}),e.onBeforeUnmount(()=>{I.value--,t.value&&a()}),{index:n,isTop:()=>n.value===h.value}}const R=e.defineComponent({__name:"OverlayBackdrop",props:{blur:{type:Boolean,default:!1},minDuration:{default:250}},setup(t){const n=t,o=e.computed(()=>n.blur),{isTop:r}=X(o);return(a,s)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["backdrop-blur-component fixed inset-0 flex justify-center items-center bg-black backdrop-blur-sm transition-opacity opacity-0 pointer-events-none",{"opacity-20 pointer-events-auto":o.value&&e.unref(r)()}])},null,2))}}),j={class:"overlay-stack"},G=e.defineComponent({__name:"OverlayStack",props:{stack:{}},setup(t){const n=t,o=e.ref(!1),r=e.computed(()=>n.stack[n.stack.length-1]),a=e.computed(()=>n.stack.slice(1)),s=O(r.value);return e.onMounted(()=>e.nextTick(()=>{o.value=!0;const l=s.onStatusChange.listen(u=>{["closing","closed"].includes(u)&&(o.value=!1,l())})})),(l,u)=>{const c=e.resolveComponent("Overlay"),i=e.resolveComponent("OverlayStack",!0);return e.openBlock(),e.createElementBlock("div",j,[e.createVNode(R,{blur:o.value,onClick:e.unref(s).close},null,8,["blur","onClick"]),e.createVNode(c,{id:r.value},null,8,["id"]),a.value.length>0?(e.openBlock(),e.createBlock(i,{key:0,stack:a.value},null,8,["stack"])):e.createCommentVNode("",!0)])}}}),S=(t,n)=>{const o=t.__vccOpts||t;for(const[r,a]of n)o[r]=a;return o},V=S(G,[["__scopeId","data-v-dad7d973"]]),A=e.defineComponent({__name:"OverlayRoot",setup(t){const{stack:n}=y();return(o,r)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[e.unref(n).length>0?(e.openBlock(),e.createBlock(V,{key:0,stack:[...e.unref(n)]},null,8,["stack"])):e.createCommentVNode("",!0)]))}}),B={sm:"max-w-sm",md:"max-w-md",lg:"max-w-lg",xl:"max-w-xl","2xl":"max-w-2xl","3xl":"max-w-3xl","4xl":"max-w-4xl","5xl":"max-w-5xl","6xl":"max-w-6xl","7xl":"max-w-7xl","80%":"max-w-[80%]",full:"max-w-[95%]"},q={class:"fixed inset-0 overflow-y-auto px-4 sm:px-0 z-50 pointer-events-none"},H={class:"h-full w-full flex justify-end"},K=e.defineComponent({__name:"OverlayDrawer",props:{show:{type:Boolean},size:{}},setup(t){const n=t,o=e.computed(()=>B[n.size]);return(r,a)=>(e.openBlock(),e.createElementBlock("div",q,[e.createElementVNode("div",H,[e.createVNode(e.Transition,{name:"slide-right",appear:""},{default:e.withCtx(()=>[e.withDirectives(e.createElementVNode("div",{class:e.normalizeClass([o.value,"bg-white pointer-events-auto shadow-xl w-full transform transition-all"])},[e.renderSlot(r.$slots,"default",{},void 0,!0)],2),[[e.vShow,t.show]])]),_:3})])]))}}),b=S(K,[["__scopeId","data-v-a636436a"]]),Q={class:"fixed inset-0 overflow-y-auto px-4 py-6 sm:px-0 z-50 pointer-events-none"},P=e.defineComponent({__name:"OverlayModal",props:{show:{type:Boolean},size:{}},setup(t){const n=t,o=e.computed(()=>B[n.size]);return(r,a)=>(e.openBlock(),e.createElementBlock("div",Q,[e.createVNode(e.Transition,{"enter-active-class":"ease-out duration-150","enter-from-class":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to-class":"opacity-100 translate-y-0 sm:scale-100","leave-active-class":"ease-in duration-150","leave-from-class":"opacity-100 translate-y-0 sm:scale-100","leave-to-class":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",appear:""},{default:e.withCtx(()=>[e.withDirectives(e.createElementVNode("div",{class:e.normalizeClass([o.value,"mb-6 bg-white rounded-lg shadow-xl transform transition-all sm:w-full sm:mx-auto pointer-events-auto overflow-hidden"])},[e.renderSlot(r.$slots,"default")],2),[[e.vShow,t.show]])]),_:3})]))}});function J(){async function t(n){const o=ne();if(!o)throw new Error("Overlay component resolver not configured. Use createInertiaOverlayPlugin()");const r=await o(n);return typeof r=="object"&&"default"in r?r.default:r}return{resolve:t}}const F=e.defineComponent({__name:"Overlay",props:{id:{}},emits:["close"],setup(t,{emit:n}){const o={modal:P,drawer:b},r=n,a=O(t.id),s=e.shallowRef(),l=e.shallowRef(),u=e.computed(()=>["open","closing"].includes(a.state.status)),c=e.computed(()=>a.state.status==="open"),{resolve:i}=J();function d(){a.close(),r("close")}return e.onBeforeMount(()=>{a.onStatusChange.listen(async _=>{switch(_){case"open":s.value=o[a.options.variant],l.value=await i(a.options.type);break}})}),(_,v)=>u.value?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(s.value),{key:0,show:c.value,size:e.unref(a).options.size},{default:e.withCtx(()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(l.value),e.mergeProps(e.unref(a).props,{onClose:d}),null,16))]),_:1},8,["show","size"])):e.createCommentVNode("",!0)}});let L;function W(t){const n=t._component.render;t._component.render=function(){return e.h("div",null,[n.call(this),e.h(A)])}}let w=null;function Z(t){var o;const n=y();if(n.hasOverlays()){const r=O(n.activeOverlayId.value);t.preserveScroll=!0,!((o=t.only)!=null&&o.length)&&!(r.index.value===0&&r.hasStatus("closing"))&&(t.only=["__overlay-partial-reload-trigger__"]),!w&&r.index.value===0&&r.hasStatus("opening")&&(w=window.location.href),t.headers[p.OVERLAY]="true",t.headers[p.OVERLAY_ID]=r.id,t.headers[p.OVERLAY_INDEX]=r.index.value.toString(),t.headers[p.OVERLAY_STACK]=n.stack.value.join(","),t.headers[p.OVERLAY_PREVIOUS_URL]=r.previousUrl,t.headers[p.OVERLAY_ROOT_URL]=w,t.headers[p.OVERLAY_PAGE_COMPONENT]=f.usePage().component}else w=null}function ee(t){const{setOptions:n}=m();t.overlay&&n(t.overlay)}function E(){const{activeOverlayId:t,size:n}=y(),{overlayQueryParam:o}=m(),r=o();if(r&&r!=t.value){const a=n()===0?0:300;setTimeout(()=>{O(r).open()},a)}}function te(t){return L=t,{install(n){n.component("Overlay",F),n.component("OverlayBackdrop",R),n.component("OverlayDrawer",b),n.component("OverlayModal",P),n.component("OverlayRoot",A),n.component("OverlayStack",V),W(n),E(),f.router.on("before",o=>{Z(o.detail.visit)}),f.router.on("success",o=>{ee(o.detail.page),E()}),console.log("Inertia Overlay Plugin installed")}}}function ne(){return L}exports.createInertiaOverlayPlugin=te;exports.useOverlay=O;
