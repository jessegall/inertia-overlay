<script setup lang="ts">

import Button from "@/components/Button.vue";
import { Deferred, router } from "@inertiajs/vue3";
import { useOverlay } from "@jessegall/inertia-overlay";

const props = defineProps<{
    prop: string;
    closureProp: string;
    lazyProp?: string;
    deferredProp?: {
        message: string;
        timestamp: string;
    },
    mergeProp: Array<{
        id: number;
        name: string;
    }>;
}>();

const emit = defineEmits(['close']);

const { createOverlay } = useOverlay();

function loadLazyProp() {
    router.reload({
        only: ['lazyProp'],
        data: {
            test: '123s'
        }
    })
}

function reloadMergeProp() {
    router.reload({
        only: ['mergeProp']
    })
}

function openDemoModal() {
    const overlay = createOverlay({
        type: 'demo.modal',
        data: {},
    })

    overlay.open();
}

function openDemoDrawer() {
    const overlay = createOverlay({
        type: 'demo.drawer',
        data: {},
    })

    overlay.open();
}

function submit() {
    router.post('/submit',
        {
            prop: props.prop,
            closureProp: props.closureProp,
            lazyProp: props.lazyProp,
        },
        {

        }
    );
}

function submitError() {
    router.post('/submit-error',
        {
            prop: props.prop,
            closureProp: props.closureProp,
            lazyProp: props.lazyProp,
            list: props.list,
        },
        {
            onSuccess: () => {
                emit('close');
            }
        }
    );
}


</script>

<template>
    <div class="p-6 flex flex-col gap-4">
        <div>
            <div>
                {{ prop }}
            </div>
            <div>
                {{ closureProp }}
            </div>
            <div>
                {{ lazyProp }}
            </div>
            <div>
                <Deferred data="deferredProp">
                    <template #fallback>
                        Loading deferred prop...
                    </template>
                    <div>
                        {{ deferredProp?.message }} - {{ deferredProp?.timestamp }}
                    </div>
                </Deferred>
            </div>
        </div>
        <div>
            <div v-for="item in mergeProp" :key="item.id">
                <div>
                    {{ item.id }}
                </div>
                <div>
                    {{ item.name }}
                </div>
            </div>
        </div>
        <div class="flex gap-2">
            <Button @click="loadLazyProp">
                Load lazy props
            </Button>
            <Button @click="openDemoModal">
                Open Another Demo Modal
            </Button>
            <Button @click="openDemoDrawer">
                Open Demo Drawer
            </Button>
        </div>
        <div class="flex gap-2">
            <Button @click="submit">
                Submit
            </Button>
            <Button @click="submitError">
                Submit With Error
            </Button>
            <Button @click="reloadMergeProp">
                Reload Merge Prop
            </Button>
        </div>
    </div>
</template>

<style scoped>

</style>